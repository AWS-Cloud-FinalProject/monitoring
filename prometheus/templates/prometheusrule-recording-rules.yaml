apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: prometheus-recording-rules
  namespace: {{ .Release.Namespace }}
  labels:
    app: prometheus
    role: recording-rules
spec:
  groups:
  {{- range $path, $_ := .Files.Glob "recording-rules/*.yaml" }}
  {{- with $.Files.Get $path | fromYaml }}
  {{- range .spec.groups }}
  - name: {{ .name | default (printf "%s" ($path | base | trimSuffix ".yaml")) }}
    rules:
{{ toYaml .rules | indent 4 }}
  {{- end }}
  {{- end }}
  {{- end }} 